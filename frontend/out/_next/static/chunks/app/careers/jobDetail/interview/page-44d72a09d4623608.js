(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[923],{2265:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c});var n=t(5155),o=t(2115),s=t(5695);function i(){let{useSearchParams:e}=t(5695),r=(0,s.useRouter)(),i=e().get("id"),[c,a]=(0,o.useState)([]),[l,u]=(0,o.useState)(!1),[d,h]=(0,o.useState)(!1),[p,g]=(0,o.useState)(!1),[f,m]=(0,o.useState)(""),[w,b]=(0,o.useState)(""),[x,v]=(0,o.useState)("Initializing..."),y=(0,o.useRef)(null),k=(0,o.useRef)(null),S=(0,o.useRef)(null),N=(0,o.useRef)([]),j=(0,o.useRef)(null);(0,o.useEffect)(()=>i?window.SpeechRecognition||window.webkitSpeechRecognition?(I(),()=>{y.current&&y.current.close(),k.current&&k.current.stop(),S.current&&S.current.close()}):void O("Your browser does not support Speech Recognition. Please use Chrome, Edge, or Safari."):void O("No interview ID found. Please go back and enter your interview ID."),[i]),(0,o.useEffect)(()=>{j.current&&(j.current.scrollTop=j.current.scrollHeight)},[c]);let E=()=>{try{return S.current&&"closed"!==S.current.state||(S.current=new(window.AudioContext||window.webkitAudioContext)),!0}catch(e){return console.error("Audio context initialization failed:",e),O("Failed to initialize audio playback. Please check your browser settings."),!1}},I=()=>{v("Requesting microphone access..."),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then(()=>{v("Microphone access granted."),C(),P()}).catch(e=>{console.error("Microphone permission denied:",e),O("Microphone access denied. Please allow microphone access to start the interview."),v("Microphone access denied.")}):(O("Your browser does not support microphone access. Please use a modern browser."),v("Microphone access not supported by browser."))},C=()=>{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e)return O("Speech recognition is not supported on this browser."),!1;let r=new e;return r.continuous=!0,r.interimResults=!0,r.lang="en-US",r.onresult=e=>{let r="";for(let t=e.resultIndex;t<e.results.length;t++){let n=e.results[t],o=n[0].transcript;n.isFinal?b(e=>e+o.trim()+" "):r+=o}m((w+r).trim()),d&&v("Listening...")},r.onerror=e=>{console.error("Speech recognition error:",e.error);let t="Speech recognition error: ".concat(e.error,".");if("not-allowed"===e.error?O(t="Microphone access was denied. Please allow microphone access to continue the interview."):"no-speech"===e.error?v(t="No speech detected. Please try speaking when the microphone is on."):O(t),d){h(!1);try{r.stop()}catch(e){console.warn("Error trying to stop recognition after an error:",e)}}v("Error: ".concat(e.error,". Mic turned off."))},r.onend=()=>{h(!1),d&&"Listening..."===x&&v('Listening session ended. Click "Turn On Mic" to speak again.')},k.current=r,!0},P=()=>{if(!i)return void O("No interview ID found. Please go back and enter your interview ID.");y.current&&(y.current.onopen=null,y.current.onmessage=null,y.current.onclose=null,y.current.onerror=null,y.current.close());let e="https:"===window.location.protocol?"wss:":"ws:",r="".concat(e,"//").concat("localhost:8000","/ws/interview/").concat(i,"/");console.log("Connecting to WebSocket URL:",r);let t=new WebSocket(r);y.current=t,v("Connecting to interview session..."),t.onopen=()=>{console.log("WebSocket connection established"),u(!0),O("Interview session connected. The AI interviewer will start with the first question."),v("Connected. Waiting for AI question.")},t.onmessage=e=>{"string"==typeof e.data?R(e.data):M(e.data)},t.onclose=e=>{if(console.log("WebSocket connection closed:",e.code,e.reason),u(!1),O(1e3!==e.code?"Interview session disconnected (Code: ".concat(e.code,"). Please refresh the page to try again."):"Interview session ended."),d){h(!1);try{var r;null==(r=k.current)||r.stop()}catch(e){console.warn("Error stopping recognition on WS close:",e)}}b(""),m(""),v("Disconnected. Please refresh the page.")},t.onerror=e=>{if(console.error("WebSocket error:",e),O("Error with the interview connection. Please try refreshing the page."),u(!1),d){h(!1);try{var r;null==(r=k.current)||r.stop()}catch(e){console.warn("Error stopping recognition on WS error:",e)}}v("Connection error. Please refresh.")}},R=e=>{if(console.log("Received text message:",e),e.startsWith("AI_QUESTION_TEXT:"))T(e.substring(17));else if(e.startsWith("ERROR:")){let r=e.substring(6);O("Server Error: ".concat(r)),v("Server error occurred.")}else O(e)},M=async e=>{if(!E()){O("Cannot play AI response: Audio context not available. Please read the question."),v("Audio playback error. Read question above.");return}N.current.push(e),A()},A=async()=>{if(!p&&0!==N.current.length&&S.current){if(g(!0),v("AI is speaking..."),d){var e;h(!1),null==(e=k.current)||e.stop(),b(""),m(""),O("Your microphone was turned off as the AI started speaking.")}try{let e=N.current.shift();if(!e)return void g(!1);let r=await e.arrayBuffer();"suspended"===S.current.state&&await S.current.resume();let t=await S.current.decodeAudioData(r),n=S.current.createBufferSource();n.buffer=t,n.connect(S.current.destination),n.onended=()=>{g(!1),N.current.length>0?A():v('AI finished. Click "Turn On Microphone" to respond.')},n.start(0)}catch(e){console.error("Error processing audio:",e),O("Error playing AI audio: ".concat(e instanceof Error?e.message:"Unknown error",". You can read the question above.")),g(!1),N.current.length>0?A():v('Error playing audio. Click "Turn On Mic" to respond.')}}},W=e=>{y.current&&y.current.readyState===WebSocket.OPEN?y.current.send(e):(console.error("WebSocket not open. Cannot send message."),O("Cannot send message: Connection lost. Please refresh."),v("Failed to send. Connection lost."))},O=e=>{a(r=>[...r,{type:"system",content:e}])},D=e=>{a(r=>[...r,{type:"user",content:e}])},T=e=>{a(r=>[...r,{type:"ai",content:e}])};return(0,n.jsxs)("div",{className:"flex flex-col h-screen bg-gray-50",children:[(0,n.jsxs)("header",{className:"bg-white border-b border-gray-200 px-4 py-2 flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("button",{onClick:()=>{y.current&&y.current.close(),r.push("/careers")},className:"mr-4 text-gray-600 hover:text-gray-900",children:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),(0,n.jsx)("h1",{className:"text-xl font-semibold",children:"AI Interview Session"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)("div",{className:"px-3 py-1 rounded-full text-sm ".concat(l?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:l?"Connected":"Disconnected"}),i&&(0,n.jsxs)("div",{className:"text-sm text-gray-600",children:["ID: ",i]})]})]}),(0,n.jsx)("div",{ref:j,className:"flex-1 p-4 overflow-y-auto",children:c.map((e,r)=>(0,n.jsxs)("div",{className:"mb-4 p-3 rounded-lg max-w-3xl ".concat("user"===e.type?"ml-auto bg-blue-100 text-blue-900":"ai"===e.type?"bg-gray-100 text-gray-900":"mx-auto bg-yellow-100 text-yellow-900 text-sm"),children:[(0,n.jsxs)("div",{className:"font-semibold mb-1",children:["user"===e.type?"You":"ai"===e.type?"AI Interviewer":"System",":"]}),(0,n.jsx)("div",{children:e.content})]},r))}),(0,n.jsxs)("div",{className:"bg-gray-50 border-t border-gray-200 p-4",children:[(0,n.jsxs)("div",{className:"mb-2 flex justify-between items-center",children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-700",children:x}),(0,n.jsxs)("div",{className:"text-sm font-medium px-2 py-1 rounded ".concat(d?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:["Microphone: ",d?"On":"Off"]})]}),(0,n.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-3 mb-4 min-h-[60px] max-h-[120px] overflow-y-auto",children:f||(d?"Speak now...":"Your speech will appear here...")}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)("button",{onClick:()=>{if(!k.current&&(C(),!k.current))return void O("Failed to set up speech recognition. Please check permissions and browser.");if(d){h(!1),k.current.stop();let e=w.trim();e&&y.current&&y.current.readyState===WebSocket.OPEN?(W(e),D(e),v("Response sent. Waiting for AI...")):e?(v("Mic off. WebSocket not open. Could not send."),O("Error: Connection to server lost. Your response was not sent. Please refresh.")):v("Mic off. No speech recorded to send."),m(""),b("")}else{if(p){O("Please wait for the AI to finish speaking before turning on your microphone."),v("AI is speaking. Please wait...");return}if(!y.current||y.current.readyState!==WebSocket.OPEN){O("Not connected to the server. Cannot start microphone."),v("Connection error. Please refresh.");return}b(""),m("");try{k.current.start(),h(!0),v("Listening...")}catch(e){console.error("Error starting speech recognition:",e),h(!1),e instanceof Error&&("InvalidStateError"===e.name?v("Microphone is already starting or active."):(v("Mic error: ".concat(e.message)),O("Error starting microphone: ".concat(e.message,". Please check your microphone and browser permissions."))))}}},disabled:!l||p,className:"px-4 py-2 rounded-lg font-medium ".concat(d?"bg-red-600 hover:bg-red-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"," ").concat(!l||p?"opacity-50 cursor-not-allowed":""),children:d?"Send Response & Turn Off Mic":"Turn On Microphone"})})]})]})}function c(){return(0,n.jsx)(o.Suspense,{fallback:(0,n.jsx)("div",{className:"flex justify-center items-center h-screen",children:"Loading..."}),children:(0,n.jsx)(i,{})})}},3895:(e,r,t)=>{Promise.resolve().then(t.bind(t,2265))},5695:(e,r,t)=>{"use strict";t.r(r);var n=t(8999),o={};for(let e in n)"default"!==e&&(o[e]=()=>n[e]);t.d(r,o)}},e=>{var r=r=>e(e.s=r);e.O(0,[441,684,358],()=>r(3895)),_N_E=e.O()}]);